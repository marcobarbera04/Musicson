<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentazione Tecnica - Musicson Lessons</title>
    <style>
        /* --- STILI GENERALI --- */
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            max-width: 950px;
            margin: 0 auto;
            padding: 40px;
            background-color: #f8f9fa;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 50px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        h1 { margin: 0; color: #2c3e50; font-size: 2.2em; }
        .subtitle { color: #7f8c8d; font-size: 1.1em; margin-top: 10px; }

        /* Sezioni */
        section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        h2 {
            color: #2980b9;
            border-left: 5px solid #3498db;
            padding-left: 15px;
            margin-top: 0;
        }

        h3 { color: #34495e; margin-top: 25px; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        /* Testo e Liste */
        p { text-align: justify; margin-bottom: 15px; }
        ul, ol { margin-bottom: 20px; padding-left: 25px; }
        li { margin-bottom: 8px; }

        /* Codice e File Tree */
        pre {
            background-color: #2d3436;
            color: #dfe6e9;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #c0392b;
            font-size: 0.9em;
        }

        /* Tabelle */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 0.95em;
        }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #3498db; color: white; font-weight: 600; }
        tr:hover { background-color: #f1f2f6; }

        /* Badges */
        .badge {
            display: inline-block; padding: 4px 8px; border-radius: 4px;
            color: white; font-weight: bold; font-size: 0.75em; text-transform: uppercase;
        }
        .js { background-color: #f1c40f; color: #333; }
        .php { background-color: #8e44ad; }
        .rest-get { background-color: #3498db; }
        .rest-post { background-color: #27ae60; }
        .folder { color: #e67e22; font-weight: bold; }

        /* Footer */
        footer { text-align: center; font-size: 0.85em; color: #7f8c8d; margin-top: 50px; }
    </style>
</head>
<body>

    <header>
        <h1>Progetto Musicson Lessons</h1>
        <div class="subtitle">Documentazione Tecnica v2.0: Architettura RESTful e Modularità Client-Side</div>
    </header>

    <section>
        <h2>1. Filosofia Architetturale: Il Paradigma REST</h2>
        <p>
            L'intero progetto è stato sviluppato rifiutando l'approccio procedurale classico (RPC - Remote Procedure Call) in favore di una rigorosa architettura <strong>REST (Representational State Transfer)</strong>. 
            L'obiettivo è disaccoppiare completamente il Client dal Server, rendendo il backend un puro distributore di risorse.
        </p>

        <h3>1.1 Risorse vs Azioni (Nouns over Verbs)</h3>
        <p>
            In un sistema RPC o in molti script PHP amatoriali, gli URL descrivono <em>azioni</em> (es. <code>get_teachers.php</code>, <code>login_user.php</code>). 
            In Musicson Lessons, seguiamo il principio dell'<strong>Interfaccia Uniforme</strong>: gli URL rappresentano <strong>Risorse</strong> (sostantivi). L'azione da compiere è determinata dal Verbo HTTP.
        </p>
        <ul>
            <li>❌ <strong>RPC (Errato):</strong> <code>POST /api/searchTeachers.php</code> (L'URL contiene il verbo)</li>
            <li>✅ <strong>REST (Musicson):</strong> <code>GET /api/teachers.php?strumento=Chitarra</code> (L'URL è la risorsa, il metodo è l'azione)</li>
        </ul>

        <h3>1.2 Statelessness (Assenza di Stato)</h3>
        <p>
            Il server non mantiene alcuna memoria della sessione utente tra due richieste (nessun uso di <code>$_SESSION</code> lato server per la logica API). 
            Ogni singola richiesta HTTP proveniente dal Client contiene tutte le informazioni necessarie per essere elaborata, inclusi gli header di autenticazione (<strong>Basic Auth</strong>).
            Questo garantisce scalabilità e testabilità indipendente.
        </p>
    </section>

    <section>
        <h2>2. Struttura del Progetto</h2>
        <p>
            L'applicazione rispetta una chiara separazione tra Frontend (statico + JS) e Backend (API PHP).
        </p>
        <pre>
Musicson_Lessons/
├── <span class="folder">css/</span>
│   └── style.css          <span style="color:#777;"># CSS Strutturale (no stile inline)</span>
├── <span class="folder">img/</span>
│   └── <span class="folder">profile_pictures/</span>  <span style="color:#777;"># Immagini caricate dinamicamente</span>
├── <span class="folder">js/</span>                    <span style="color:#777;"># Moduli ES6 (Frontend)</span>
│   ├── api.js             <span style="color:#777;"># Data Layer (Fetch & Auth)</span>
│   ├── ui.js              <span style="color:#777;"># View Layer (DOM Generation)</span>
│   └── main.js            <span style="color:#777;"># Controller (Entry Point)</span>
├── <span class="folder">php/</span>
│   ├── <span class="folder">api/</span>               <span style="color:#777;"># Backend RESTful</span>
│   │   ├── appointments.php
│   │   ├── instruments.php
│   │   ├── login.php
│   │   └── teachers.php
│   └── <span class="folder">config/</span>
│       └── db.php         <span style="color:#777;"># Connessione Database (PDO)</span>
└── index.html             <span style="color:#777;"># Single Page Application Shell</span></pre>
    </section>

    <section>
        <h2>3. Frontend Modulare (ES Modules)</h2>
        <p>
            Il codice JavaScript è stato ingegnerizzato utilizzando i <strong>Moduli ES6</strong> (<code>type="module"</code>). 
            Questo approccio supera il vecchio metodo "monolitico", garantendo incapsulamento e separazione delle responsabilità (SoC).
        </p>

        <h3>3.1. api.js (Il Data Layer)</h3>
        <p>
            Questo modulo è l'unico responsabile della comunicazione con il server. Non sa nulla dell'HTML o della pagina.
        </p>
        <ul>
            <li><strong>Incapsulamento Fetch:</strong> Espone la funzione <code>getData(resource, params)</code>.</li>
            <li><strong>Gestione Parametri:</strong> Utilizza l'oggetto nativo <code>URLSearchParams</code> per convertire oggetti JavaScript (es. <code>{strumento: 'Piano'}</code>) in query string sicure (es. <code>?strumento=Piano</code>).</li>
            <li><strong>Middleware Auth:</strong> Inietta automaticamente l'header <code>Authorization: Basic ...</code> in ogni richiesta.</li>
        </ul>

        <h3>3.2. ui.js (Il View Layer)</h3>
        <p>
            Si occupa esclusivamente di generare l'HTML e manipolare il DOM.
        </p>
        <ul>
            <li><strong>Pure Functions:</strong> Funzioni come <code>createTeacherCard()</code> e <code>createAppointmentCard()</code> prendono dati JSON in ingresso e restituiscono stringhe HTML template.</li>
            <li><strong>Separazione CSS:</strong> Non applica stili inline, ma assegna classi CSS (es. <code>.teacher-card</code>) che vengono stilizzate in <code>style.css</code>.</li>
            <li><strong>Logica di Rendering:</strong> Gestisce la visualizzazione condizionale (es. mostra il link al meeting solo se presente nel JSON).</li>
        </ul>

        <h3>3.3. main.js (Il Controller)</h3>
        <p>
            Il punto di ingresso dell'applicazione.
        </p>
        <ul>
            <li><strong>Orchestrazione:</strong> Importa funzioni da <code>api.js</code> e <code>ui.js</code> e le coordina.</li>
            <li><strong>Event Listeners:</strong> Gestisce il click sul bottone di login e il caricamento iniziale (<code>window.onload</code>).</li>
            <li><strong>Esposizione Globale:</strong> Poiché i moduli sono "privati", espone esplicitamente funzioni come <code>window.logout</code> o <code>window.goHome</code> per renderle accessibili dagli attributi <code>onclick</code> dell'HTML.</li>
        </ul>
    </section>

    <section>
        <h2>4. Backend API e Database</h2>
        <p>Il backend espone le risorse in formato JSON. Il Database MySQL gestisce le relazioni complesse.</p>

        <h3>4.1. Endpoints Implementati</h3>
        <table>
            <thead>
                <tr>
                    <th>Metodo</th>
                    <th>Endpoint</th>
                    <th>Funzione</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge rest-get">GET</span></td>
                    <td><code>/instruments.php</code></td>
                    <td>Restituisce l'elenco strumenti per l'autocomplete.</td>
                </tr>
                <tr>
                    <td><span class="badge rest-get">GET</span></td>
                    <td><code>/teachers.php</code></td>
                    <td>Lista professori. Supporta filtro query string: <code>?strumento=X</code>.</td>
                </tr>
                <tr>
                    <td><span class="badge rest-get">GET</span></td>
                    <td><code>/appointments.php</code></td>
                    <td>
                        Restituisce le prenotazioni dell'utente autenticato.<br>
                        <em>Logica:</em> Estrae l'utente dall'header Auth, esegue query JOIN su <code>appointments</code> e <code>users</code>.
                    </td>
                </tr>
                <tr>
                    <td><span class="badge rest-post">POST</span></td>
                    <td><code>/login.php</code></td>
                    <td>Verifica credenziali (hash password) e restituisce il profilo utente.</td>
                </tr>
            </tbody>
        </table>

        <h3>4.2. Schema Database (MySQL)</h3>
        <p>La persistenza è garantita da un database relazionale strutturato come segue:</p>
        <ul>
            <li><strong>users</strong>: Tabella unica per Studenti e Professori (discriminati dal campo <code>role</code>).</li>
            <li><strong>instruments</strong>: Catalogo strumenti.</li>
            <li><strong>teacher_instruments</strong>: Tabella ponte (Many-to-Many) tra professori e strumenti.</li>
            <li><strong>appointments</strong>: Nuova tabella per gestire le lezioni.
                <ul>
                    <li><code>id</code> (PK), <code>student_id</code> (FK), <code>teacher_id</code> (FK)</li>
                    <li><code>datetime</code>: Data e ora della lezione.</li>
                    <li><code>meeting_link</code>: Link alla videochiamata.</li>
                </ul>
            </li>
        </ul>
    </section>

    <section>
        <h2>5. Accessibilità e Test (cURL)</h2>
        <p>
            La natura <strong>Stateless</strong> dell'API permette di testare il backend indipendentemente dal frontend. 
            È possibile simulare il comportamento dell'applicazione utilizzando strumenti da riga di comando.
        </p>
        <p><strong>Esempio reale:</strong> Recupero degli appuntamenti personali bypassando il browser.</p>
        
        <pre><code>PS C:\Users\marco> curl.exe -u "marco@gmail.com:marco123" http://localhost:8080/php/api/appointments.php

[
  {
    "id": 1, 
    "datetime": "2026-01-29 17:59:19", 
    "meeting_link": "https://meet.google/vhakeoah21", 
    "teacher_name": "Pippo", 
    "teacher_image": "pippo.png"
  }
]</code></pre>
        <p>
            Questo test conferma che l'autenticazione, la logica di filtering per utente e la generazione del JSON funzionano correttamente lato server, isolando eventuali problemi dell'interfaccia grafica.
        </p>
    </section>

    <footer>
        <p>Progetto Musicson Lessons - Programmazione Web e Mobile 2026</p>
    </footer>

</body>
</html>